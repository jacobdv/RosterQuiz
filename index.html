<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cincinnati Bengals Depth Chart</title>
    <link rel="manifest" href="#" id="manifest-placeholder">
    <meta name="theme-color" content="#FB4F14">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #FB4F14, #000000);
            min-height: 100vh;
            overflow-x: auto;
        }

        .header {
            background: linear-gradient(90deg, #FB4F14, #000000);
            color: white;
            text-align: center;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control-group h3 {
            color: white;
            font-size: 1.2rem;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .control-group .controls-row {
            display: flex;
            gap: 15px;
        }

        .personnel-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #FF6600, #FB4F14);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
        }

        .personnel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 102, 0, 0.4);
        }

        .personnel-btn.active {
            background: linear-gradient(45deg, #000000, #333333);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .field-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 30px auto;
            background: linear-gradient(180deg, #2E8B57, #228B22);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .football-field {
            position: relative;
            width: 100%;
            height: 80vh;
            min-height: 600px;
            background: linear-gradient(
                to bottom,
                #2E8B57 0%,
                #228B22 45%,
                #FFFFFF 50%,
                #228B22 55%,
                #2E8B57 100%
            );
        }

        .field-line {
            position: absolute;
            width: 100%;
            height: 4px;
            background: white;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

        .offense-side, .defense-side {
            position: absolute;
            width: 100%;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .offense-side {
            bottom: 0;
            background: rgba(34, 139, 34, 0.1);
        }

        .defense-side {
            top: 0;
            background: rgba(46, 139, 87, 0.1);
        }

        .formation {
            position: relative;
            width: 90%;
            height: 80%;
        }

        .player {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #FF6600, #FB4F14);
            border: 4px solid #000000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.4);
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .player.defense {
            background: linear-gradient(135deg, #000000, #333333);
            border: 4px solid #FB4F14;
            color: #FB4F14;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .player:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 25px rgba(255, 102, 0, 0.6);
            z-index: 10;
        }

        .player.defense:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.6);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: linear-gradient(135deg, #FFFFFF, #F5F5F5);
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(90deg, #FF6600, #000000);
            color: white;
            padding: 20px;
            margin: -30px -30px 20px -30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-headshot {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid white;
            object-fit: cover;
            background: #f0f0f0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .player-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .info-item {
            background: #F8F8F8;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #FF6600;
        }

        .info-label {
            font-weight: bold;
            color: #000000;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 1.1rem;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .controls {
                gap: 10px;
            }

            .personnel-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .player {
                width: 50px;
                height: 50px;
                font-size: 14px;
            }

            .modal-content {
                margin: 20% auto;
                width: 95%;
                padding: 20px;
            }

            .player-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Cincinnati Bengals Depth Chart</h1>
        <div class="controls">
            <div class="control-group">
                <h3>Offense</h3>
                <button class="personnel-btn offense-btn active" data-package="11-personnel">11 Personnel</button>
                <button class="personnel-btn offense-btn" data-package="12-personnel">12 Personnel</button>
            </div>
            <div class="control-group">
                <h3>Defense</h3>
                <button class="personnel-btn defense-btn" data-package="4-3-defense">4-3 Defense</button>
                <button class="personnel-btn defense-btn active" data-package="nickel-defense">Nickel Defense</button>
            </div>
        </div>
    </div>

    <div class="field-container">
        <div class="football-field">
            <div class="field-line"></div>
            <div class="defense-side">
                <div class="formation" id="defense-formation"></div>
            </div>
            <div class="offense-side">
                <div class="formation" id="offense-formation"></div>
            </div>
        </div>
    </div>

    <div id="playerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <img id="playerHeadshot" class="player-headshot" src="" alt="Player headshot" />
                <h2 id="playerName"></h2>
            </div>
            <div class="player-info">
                <div class="info-item">
                    <div class="info-label">Position</div>
                    <div class="info-value" id="playerPosition"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">College</div>
                    <div class="info-value" id="playerCollege"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Height</div>
                    <div class="info-value" id="playerHeight"></div>
                </div>
                <div class="info-item">
                    <div class="info-label">Weight</div>
                    <div class="info-value" id="playerWeight"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Player data (Updated 2025 Cincinnati Bengals roster with Bengals website headshots)
        const playerData = {
            offense: {
                QB: { name: "Joe Burrow", college: "LSU", position: "QB", height: "6'4\"", weight: "215 lbs", number: "9", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/ygxpkhhnl62zjtwb0sdm.jpg" },
                RB1: { name: "Chase Brown", college: "Illinois", position: "RB", height: "5'10\"", weight: "210 lbs", number: "30", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/wu0ol7tj3byhi8ge5wi8.jpg" },
                WR1: { name: "Ja'Marr Chase", college: "LSU", position: "WR", height: "6'0\"", weight: "205 lbs", number: "1", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/gfwnwiwhkyejcydlok3d.jpg" },
                WR2: { name: "Tee Higgins", college: "Clemson", position: "WR", height: "6'4\"", weight: "220 lbs", number: "5", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/yy10xcf2bpkc3lkqwbgo.jpg" },
                WR3: { name: "Andrei Iosivas", college: "Princeton", position: "WR", height: "6'3\"", weight: "210 lbs", number: "80", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/enck3915pfmgjyvdrfgu.jpg" },
                TE1: { name: "Mike Gesicki", college: "Penn State", position: "TE", height: "6'6\"", weight: "245 lbs", number: "88", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/aygyqh4bjsk8w0xoz1lc.jpg" },
                TE2: { name: "Drew Sample", college: "Washington", position: "TE", height: "6'5\"", weight: "260 lbs", number: "89", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/bf7a73mqrjicbffnhpep.jpg" },
                LT: { name: "Orlando Brown Jr.", college: "Oklahoma", position: "LT", height: "6'8\"", weight: "350 lbs", number: "75", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/wezsf2mzkygumodf3l3r.jpg" },
                LG: { name: "Dylan Fairchild", college: "Georgia", position: "LG", height: "6'5\"", weight: "318 lbs", number: "63", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/urdhn7tf1laxfqqjl8cg.jpg" },
                C: { name: "Ted Karras", college: "Illinois", position: "C", height: "6'4\"", weight: "310 lbs", number: "64", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/dtrozaxxy043h3zj5jh7.jpg" },
                RG: { name: "Lucas Patrick", college: "Duke", position: "RG", height: "6'3\"", weight: "313 lbs", number: "62", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/haeakhdggckeysvgshvh.jpg" },
                RT: { name: "Amarius Mims", college: "Georgia", position: "RT", height: "6'8\"", weight: "350 lbs", number: "71", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/losundqzvrgcesxtsn1j.jpg" }
            },
            defense: {
                DE1: { name: "Joseph Ossai", college: "Texas", position: "DE", height: "6'4\"", weight: "263 lbs", number: "58", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/fhvu3tyo9lf0mmw0tewa.jpg" },
                DE2: { name: "Trey Hendrickson", college: "Florida Atlantic", position: "DE", height: "6'4\"", weight: "265 lbs", number: "91", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/s4ck4yrzkxsbitkmtlsw.jpg" },
                DT1: { name: "B.J. Hill", college: "NC State", position: "DT", height: "6'3\"", weight: "311 lbs", number: "92", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/kuhxskkp3t201soqlasz.jpg" },
                DT2: { name: "T.J. Slaton Jr.", college: "Florida", position: "DT", height: "6'5\"", weight: "340 lbs", number: "98", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/ozhshwj1mmhklgortggy.jpg" },
                LB1: { name: "Logan Wilson", college: "Wyoming", position: "LB", height: "6'2\"", weight: "245 lbs", number: "55", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/bj9ecds8hgiwiief4k8q.jpg" },
                LB2: { name: "Demetrius Knight Jr.", college: "Duke", position: "LB", height: "6'2\"", weight: "240 lbs", number: "44", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/lsgx1n6hqv75wrd53wlt.jpg" },
                LB3: { name: "Barrett Carter", college: "Clemson", position: "LB", height: "6'0\"", weight: "231 lbs", number: "49", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/bdqmnxhoa1uxrhe4fwib.jpg" },
                CB1: { name: "DJ Turner II", college: "Michigan", position: "CB", height: "5'11\"", weight: "185 lbs", number: "20", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/d2z6fhshltawesic84gu.jpg" },
                CB2: { name: "Cam Taylor-Britt", college: "Nebraska", position: "CB", height: "5'11\"", weight: "200 lbs", number: "29", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/jyuudahlp8rsrfghuzzl.jpg" },
                CB3: { name: "Dax Hill", college: "Michigan", position: "CB", height: "6'0\"", weight: "195 lbs", number: "23", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/lckj03eyvkhkleyl9zo4.jpg" },
                S1: { name: "Geno Stone", college: "Iowa", position: "S", height: "5'11\"", weight: "210 lbs", number: "22", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/bdz5juxo0qetz9yl5xpq.jpg" },
                S2: { name: "Jordan Battle", college: "Alabama", position: "S", height: "6'1\"", weight: "215 lbs", number: "27", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/riwbpynlveo3dxek3eeo.jpg" },
                S3: { name: "Tycen Anderson", college: "Toledo", position: "S", height: "6'2\"", weight: "205 lbs", number: "26", headshot: "https://static.clubs.nfl.com/image/upload/t_editorial_landscape_6_desktop_2x/f_auto/bengals/ulj2wvdweunv6g64akkd.jpg" }
            }
        };

        // Formation configurations - positioned relative to 50-yard line with no overlaps
        const formations = {
            '11-personnel': {
                offense: {
                    QB: { x: 50, y: 75 },  // Closest to 50-yard line
                    RB1: { x: 60, y: 77 },
                    WR1: { x: 5, y: 10 }, // Far from 50-yard line
                    WR2: { x: 95, y: 10 },
                    WR3: { x: 15, y: 17 },
                    TE1: { x: 78, y: 17 },
                    LT: { x: 30, y: 12 },
                    LG: { x: 40, y: 11 },
                    C: { x: 50, y: 10 },
                    RG: { x: 60, y: 11 },
                    RT: { x: 70, y: 12 }
                },
                defense: {
                    DE1: { x: 15, y: 75 }, // Far from 50-yard line
                    DT1: { x: 35, y: 75 },
                    DT2: { x: 65, y: 75 },
                    DE2: { x: 85, y: 75 },
                    LB1: { x: 25, y: 50 },
                    LB2: { x: 50, y: 50 },
                    LB3: { x: 75, y: 50 },
                    CB1: { x: 5, y: 20 }, // Close to 50-yard line
                    CB2: { x: 95, y: 20 },
                    S1: { x: 30, y: 15 },
                    S2: { x: 70, y: 15 }
                }
            },
            '12-personnel': {
                offense: {
                    QB: { x: 50, y: 30 },  // Closest to 50-yard line
                    RB1: { x: 50, y: 80 },
                    WR1: { x: 5, y: 10 }, // Far from 50-yard line
                    WR2: { x: 95, y: 10 },
                    TE1: { x: 78, y: 17 },
                    TE2: { x: 22, y: 17 },
                    LT: { x: 30, y: 12 },
                    LG: { x: 40, y: 11 },
                    C: { x: 50, y: 10 },
                    RG: { x: 60, y: 11 },
                    RT: { x: 70, y: 12 }
                },
                defense: {
                    DE1: { x: 15, y: 75 },
                    DT1: { x: 35, y: 75 },
                    DT2: { x: 65, y: 75 },
                    DE2: { x: 85, y: 75 },
                    LB1: { x: 25, y: 50 },
                    LB2: { x: 50, y: 50 },
                    LB3: { x: 75, y: 50 },
                    CB1: { x: 5, y: 20 },
                    CB2: { x: 95, y: 20 },
                    S1: { x: 30, y: 15 },
                    S2: { x: 70, y: 15 }
                }
            },
            '4-3-defense': {
                offense: {
                    QB: { x: 50, y: 30 },  // Closest to 50-yard line
                    RB1: { x: 50, y: 80 },
                    WR1: { x: 5, y: 10 }, // Far from 50-yard line
                    WR2: { x: 95, y: 10 },
                    TE1: { x: 78, y: 17 },
                    TE2: { x: 22, y: 17 },
                    LT: { x: 30, y: 12 },
                    LG: { x: 40, y: 11 },
                    C: { x: 50, y: 10 },
                    RG: { x: 60, y: 11 },
                    RT: { x: 70, y: 12 }
                },
                defense: {
                    DE1: { x: 27, y: 75 },
                    DT1: { x: 40, y: 75 },
                    DT2: { x: 53, y: 75 },
                    DE2: { x: 73, y: 75 },
                    LB1: { x: 25, y: 50 },
                    LB2: { x: 50, y: 45 },
                    LB3: { x: 75, y: 50 },
                    CB1: { x: 5, y: 65 },
                    CB2: { x: 95, y: 65 },
                    S1: { x: 30, y: 10 },
                    S2: { x: 70, y: 10 }
                }
            },
            'nickel-defense': {
                offense: {
                    QB: { x: 50, y: 75 },  // Closest to 50-yard line
                    RB1: { x: 60, y: 77 },
                    WR1: { x: 5, y: 10 }, // Far from 50-yard line
                    WR2: { x: 95, y: 10 },
                    WR3: { x: 15, y: 17 },
                    TE1: { x: 78, y: 17 },
                    LT: { x: 30, y: 12 },
                    LG: { x: 40, y: 11 },
                    C: { x: 50, y: 10 },
                    RG: { x: 60, y: 11 },
                    RT: { x: 70, y: 12 }
                },
                defense: {
                    DE1: { x: 27, y: 75 },
                    DT1: { x: 40, y: 75 },
                    DT2: { x: 53, y: 75 },
                    DE2: { x: 73, y: 75 },
                    LB1: { x: 35, y: 50 },
                    LB2: { x: 65, y: 45 },
                    CB1: { x: 5, y: 65 },
                    CB2: { x: 95, y: 65 },
                    CB3: { x: 15, y: 50 },
                    S1: { x: 30, y: 10 },
                    S2: { x: 70, y: 10 }
                }
            }
        };

        let currentOffensePackage = '11-personnel';
        let currentDefensePackage = 'nickel-defense';

        // Create manifest data
        const manifestData = {
            name: "Cincinnati Bengals Depth Chart",
            short_name: "Bengals Depth",
            description: "Interactive depth chart for the Cincinnati Bengals NFL team",
            start_url: "./",
            display: "standalone",
            background_color: "#FF6600",
            theme_color: "#FF6600",
            icons: [
                {
                    src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Ccircle fill='%23FF6600' cx='96' cy='96' r='96'/%3E%3Ctext x='96' y='110' text-anchor='middle' font-size='80' font-weight='bold' fill='%23000000'%3EB%3C/text%3E%3C/svg%3E",
                    sizes: "192x192",
                    type: "image/svg+xml"
                },
                {
                    src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Ccircle fill='%23FF6600' cx='256' cy='256' r='256'/%3E%3Ctext x='256' y='300' text-anchor='middle' font-size='200' font-weight='bold' fill='%23000000'%3EB%3C/text%3E%3C/svg%3E",
                    sizes: "512x512",
                    type: "image/svg+xml"
                }
            ]
        };

        // Create and inject manifest
        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestURL;

        // Service Worker registration with inline approach
        if ('serviceWorker' in navigator) {
            // Create service worker as a data URL instead of blob
            const swCode = `
                const CACHE_NAME = 'bengals-depth-chart-v1';
                
                // Cache key resources
                const resourcesToCache = [];

                self.addEventListener('install', event => {
                    console.log('Service Worker: Installing');
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => {
                                console.log('Service Worker: Caching files');
                                // Cache the current page
                                return cache.add('./');
                            })
                            .catch(err => console.log('Service Worker: Cache failed', err))
                    );
                    self.skipWaiting();
                });

                self.addEventListener('activate', event => {
                    console.log('Service Worker: Activating');
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cache => {
                                    if (cache !== CACHE_NAME) {
                                        console.log('Service Worker: Clearing old cache');
                                        return caches.delete(cache);
                                    }
                                })
                            );
                        })
                    );
                    self.clients.claim();
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => {
                                // Return cached version or fetch from network
                                return response || fetch(event.request);
                            })
                            .catch(() => {
                                // Fallback for offline
                                if (event.request.destination === 'document') {
                                    return caches.match('./');
                                }
                            })
                    );
                });
            `;

            // Use data URL instead of blob URL for better compatibility
            const swDataURL = 'data:application/javascript;base64,' + btoa(swCode);

            navigator.serviceWorker.register(swDataURL)
                .then(registration => {
                    console.log('✅ Service Worker registered successfully:', registration.scope);
                    
                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        console.log('Service Worker: Update found');
                    });
                })
                .catch(error => {
                    console.log('❌ Service Worker registration failed:', error);
                    // Graceful fallback - app still works without SW
                    console.log('App will continue to work, but without offline capabilities');
                });
        } else {
            console.log('Service Worker not supported in this browser');
        }

        // App functionality
        function createPlayer(playerKey, player, x, y, isDefense = false) {
            const playerElement = document.createElement('div');
            playerElement.className = isDefense ? 'player defense' : 'player';
            playerElement.style.left = x + '%';
            playerElement.style.top = y + '%';
            playerElement.textContent = player.number;
            playerElement.addEventListener('click', () => showPlayerModal(player));
            return playerElement;
        }

        function renderFormation(offensePackage, defensePackage) {
            const offenseContainer = document.getElementById('offense-formation');
            const defenseContainer = document.getElementById('defense-formation');
            
            offenseContainer.innerHTML = '';
            defenseContainer.innerHTML = '';

            const offenseFormation = formations[offensePackage].offense;
            const defenseFormation = formations[defensePackage].defense;

            // Render offense
            Object.entries(offenseFormation).forEach(([key, position]) => {
                const player = playerData.offense[key];
                if (player) {
                    const playerElement = createPlayer(key, player, position.x, position.y, false);
                    offenseContainer.appendChild(playerElement);
                }
            });

            // Render defense
            Object.entries(defenseFormation).forEach(([key, position]) => {
                const player = playerData.defense[key];
                if (player) {
                    const playerElement = createPlayer(key, player, position.x, position.y, true);
                    defenseContainer.appendChild(playerElement);
                }
            });
        }

        function showPlayerModal(player) {
            document.getElementById('playerName').textContent = player.name;
            document.getElementById('playerPosition').textContent = player.position;
            document.getElementById('playerCollege').textContent = player.college;
            document.getElementById('playerHeight').textContent = player.height;
            document.getElementById('playerWeight').textContent = player.weight;
            
            // Set player headshot with fallback
            const headshotImg = document.getElementById('playerHeadshot');
            headshotImg.src = player.headshot;
            headshotImg.onerror = function() {
                this.style.display = 'none';
            };
            headshotImg.onload = function() {
                this.style.display = 'block';
            };
            
            document.getElementById('playerModal').style.display = 'block';
        }

        function hidePlayerModal() {
            document.getElementById('playerModal').style.display = 'none';
        }

        // Event listeners - separate offense and defense controls
        document.querySelectorAll('.offense-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.offense-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentOffensePackage = e.target.dataset.package;
                renderFormation(currentOffensePackage, currentDefensePackage);
            });
        });

        document.querySelectorAll('.defense-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.defense-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentDefensePackage = e.target.dataset.package;
                renderFormation(currentOffensePackage, currentDefensePackage);
            });
        });

        document.querySelector('.close').addEventListener('click', hidePlayerModal);
        document.getElementById('playerModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) hidePlayerModal();
        });

        // Initialize app
        renderFormation(currentOffensePackage, currentDefensePackage);

        // PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            console.log('PWA install prompt available');
        });
    </script>
</body>
</html>
